NB: attention Ã  lâ€™indentation dans le hosts file au format yaml

cat hosts
all:
hosts:
10.0.0.4:
ansible_user: admin
ansible_password: admin
ansible_ssh_common_args: â€˜-o StrictHostKeyChecking=noâ€™
10.0.0.5:
ansible_user: admin
ansible_password: admin
ansible_ssh_common_args: â€˜-o StrictHostKeyChecking=noâ€™

 

ping command
ansible -i hosts all -m ping

 

create file command
ansible -i hosts all -m copy -a â€œdest=/home/admin/toto.txt content=â€™bonjour eazytraining'â€


----------------------


[200~TP-4 : [correction] code utilisÃ©
cat hosts.ini

[all:vars]
ansible_user=admin
ansible_ssh_common_args=â€™-o StrictHostKeyChecking=noâ€™

[prod]
client ansible_host=10.0.0.4

[prod:vars]
ansible_password=admin
env=production

ansible -i hosts.ini all -m ping
ansible -i hosts.ini all -m copy -a â€œdest=/home/admin/toto.txt content=â€™bonjour eazytraining {{ env }}'â€

NB: attention Ã  lâ€™indentation au niveau du fichier yaml

cat hosts.yml
all:
vars:
ansible_user: admin
ansible_ssh_common_args: â€˜-o StrictHostKeyChecking=noâ€™
prod:
hosts:
client:
ansible_host: 10.0.0.4
vars:
ansible_password: admin
env: production

Ping
ansible -i hosts.yml all -m ping
ansible -i hosts.yml all -m copy -a â€œdest=/home/admin/toto.txt content=â€™bonjour eazytraining {{ env }}'â€



--------------


[200~TP-5 : [correction] code utilisÃ©
NB: attention Ã  lâ€™indentation pour les fichiers yaml

cat hosts.yml
all:
vars:
ansible_ssh_common_args: â€˜-o StrictHostKeyChecking=noâ€™
prod:
hosts:
client:
ansible_host: 10.0.0.4

cat group_vars/prod.yml
ansible_user: admin
ansible_password: admin

 

cat deploy.yml

https://raw.githubusercontent.com/sadofrazer/ansible_training/master/webapp/webapp.yml

â€”
â€“ name: â€œApache installation using dockerâ€
hosts: Prod
become: true
vars:
pre_tasks:
â€“ name: Install EPEL repo
package: name=epel-release state=present
when: ansible_distribution == â€œCentOSâ€

â€“ name: download pip script
get_url:
url: https://bootstrap.pypa.io/pip/2.7/get-pip.py
dest: /tmp/get-pip.py

â€“ name: install python-pip
command: python2.7 /tmp/get-pip.py

â€“ name: Install docker python
pip: name=docker-py

tasks:
â€“ name: Create Apache container
docker_container:
name: webapp
image: httpd
ports:
â€“ â€œ80:80â€

 

Install ansible lint

sudo yum install python-pip
sudo pip install ansible-lint
ansible-lint deploy.yml

ansible-playbook -i hosts.yml deploy.yml

Ansible verbose option
ansible-playbook -i hosts.yml -vvv deploy.yml

Push code 
git init
git add .
git config â€“global user.email â€œdiranetafen@yahoo.comâ€
git config â€“global user.name â€œdiraneâ€
git commit -m â€œwebapp first versionâ€
git add origin
git push origin master
